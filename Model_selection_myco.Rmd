---
title: "Model_selection_myco"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Model selection mycorrhiza 

The linear model will have to be made, with the trait-presence-column as the dependent variable, and the 
GIS data frames as the predictor variables. The function phylostep of the phylolm package will be used. 

## Results of VIF-analysis
```{r VIF analysis}
#load required package
library(usdm)

#fill in the arguments of the function and execute it 
vif(GIS_myco[,c(3:43)])

#choose the variables to delete that have a higher VIF value than 10, but make sure it makes sense in terms of biology, results in:

# 1. Solely based on highest VIF value
vif(GIS_myco[,c(3:5, 7, 14, 20, 22:24, 26, 28, 39, 42, 43)])

# 2. With embergerQ
vif(GIS_myco[,c(3:5, 7, 10, 14, 20, 22:24, 26, 28, 39, 42)])

# 3. With climaticMoistureIndex
vif(GIS_myco[,c(3:5, 8, 14, 20, 22:24, 26, 28, 39, 43)])

# 4. With continentality
vif(GIS_myco[,c(3:5, 7, 9, 14, 20, 22:24, 26, 39, 42, 43)])

# 5. With thermicityIndex
vif(GIS_myco[,c(3:5, 20, 21, 22:24, 26, 39, 42, 43)])

# 6. With BIO8 and BIO9 
vif(GIS_myco[,c(3:5, 7, 22:24, 26, 32, 33, 39, 42, 43)])

# 7. With BIO8, BIO9, and EmbergerQ
vif(GIS_myco[,c(3:5, 10, 22:24, 26, 32, 33, 39, 42)])

# 8. With BIO8, BIO9, and climaticMoistureIndex
vif(GIS_myco[,c(3:5, 8, 22:24, 32, 33, 39, 43)])

# 9. With embergerQ and thermicityIndex
vif(GIS_myco[,c(3, 4, 10, 21, 23, 24, 26, 39, 42)])

# 10. With climaticMoistureIndex and thermicityIndex
vif(GIS_myco[,c(3:5, 8, 20, 21, 22:24, 26, 39, 43)])

```

## Change data to match the wanted data format
There are some flaws in the GIS data frame that make it unfit for the phylostep function. First of all
the row names have to match the tip.lables of the tree, and secondly the trait value (0/1) has to be
seen as a numeric value. 
```{r}
#make allmb_name column into the row names of this table
rownames(GIS_myco) <- GIS_myco[,1]
GIS_myco[,1] <- NULL

#make sure the values in the 'woody' column are seen as numeric values
GIS_myco$mycorrhiza <- as.numeric(GIS_myco$mycorrhiza)
#check whether it worked
is.numeric(GIS_myco$mycorrhiza)
```

## Define formulas
```{r define formula}
# 0. Starting formula
myco_starting_formula <- mycorrhiza ~ 1
  
# 1. Solely based on highest VIF value
myco_formula_1 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + aridityIndexThornthwaite + minTempWarmest + PETWettestQuarter + OrganicCarbon + PhCaCL + Slope + bio2 + bio4 + bio15 + bio18 + bio19

# 2. With embergerQ
myco_formula_2 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + aridityIndexThornthwaite + embergerQ + minTempWarmest + PETWettestQuarter + OrganicCarbon + PhCaCL + Slope + bio2 + bio4 + bio15 + bio18 

# 3. With climaticMoistureIndex
myco_formula_3 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + climaticMoistureIndex + minTempWarmest + PETWettestQuarter + OrganicCarbon + PhCaCL + Slope + bio2 + bio4 + bio15 + bio19

# 4. With continentality
myco_formula_4 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + aridityIndexThornthwaite + continentality + minTempWarmest + PETWettestQuarter + OrganicCarbon + PhCaCL + Slope + bio2 + bio15 + bio18 + bio19

# 5. With thermicityIndex
myco_formula_5 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + PETWettestQuarter + thermicityIndex + OrganicCarbon + PhCaCL + Slope + bio2 + bio15 + bio18 + bio19

# 6. With BIO8 and BIO9 
myco_formula_6 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + aridityIndexThornthwaite + OrganicCarbon + PhCaCL + Slope + bio2 + bio8 + bio9 + bio15 + bio18 + bio19

# 7. With BIO8, BIO9, and EmbergerQ
myco_formula_7 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + embergerQ + OrganicCarbon + PhCaCL + Slope + bio2 + bio8 + bio9 + bio15 + bio18

# 8. With BIO8, BIO9, and climaticMoistureIndex
myco_formula_8 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + climaticMoistureIndex + OrganicCarbon + PhCaCL + Slope + bio8 + bio9 + bio15 + bio19

# 9. With embergerQ and thermicityIndex
myco_formula_9 <- mycorrhiza ~ Aspect + BulkDensity + embergerQ + thermicityIndex + PhCaCL + Slope + bio2 + bio15 + bio18

# 10. With climaticMoistureIndex and thermicityIndex
myco_formula_10 <- mycorrhiza ~ Aspect + BulkDensity + ClayPercentage + climaticMoistureIndex + PETWettestQuarter + thermicityIndex + OrganicCarbon + PhCaCL + Slope + bio2 + bio15 + bio19

```

## Extra formulas
```{r}
# 11. annualPET
vif(GIS_myco[,c(3:5, 6, 14, 22:24, 31, 38, 39, 42, 43)])

# 12. growingDegDays0
vif(GIS_myco[,c(3:5, 11, 20, 22:24, 26, 38, 39, 42, 43)])

# 13. growingDegDays5
vif(GIS_myco[,c(3:5, 12, 14, 20, 22:24, 26, 38, 39, 42, 43)])

# 14. maxTempColdest
vif(GIS_myco[,c(3:5, 7, 13, 14, 20, 22:24, 26, 39, 42, 43)])

# 15. monthCountByTemp10
vif(GIS_myco[,c(3:5, 7, 14, 15, 20, 22:24, 26, 39, 42, 43)])

# 16. PETColdestQuarter
vif(GIS_myco[,c(3:5, 14, 16, 20, 22:24, 26, 38, 39, 42, 43)])

# 17. PETDriestQuarter
vif(GIS_myco[,c(3:5, 14, 17, 22:24, 26, 28, 38, 39, 42, 43)])

# 18. PETseasonality
vif(GIS_myco[,c(3:5, 7, 14, 18, 22:24, 26, 28, 39, 42, 43)])

# 19. PETWarmestQuarter
vif(GIS_myco[,c(3:5, 7, 14, 19, 20, 22:24, 28, 39, 42, 43)])

# 20. bio1
vif(GIS_myco[,c(3:5, 7, 18, 20, 22:24, 25, 26, 39, 42, 43)])

# 21. bio3
vif(GIS_myco[,c(3:5, 7, 14, 20, 22:24, 26, 27, 39, 42, 43)])

# 22. bio5 
vif(GIS_myco[,c(3:5, 7, 20, 22:24, 26, 28, 29, 39, 42, 43)])

# 23. bio6
vif(GIS_myco[,c(3:5, 7, 14,20, 22:24, 26, 30, 39, 42, 43)])

# 24. bio7
vif(GIS_myco[,c(3:5, 7, 14, 20, 22:24, 26, 31, 39,42, 43)])

# 25. bio10
vif(GIS_myco[,c(3:5, 7,20, 22:24,26, 28, 34, 39, 42, 43)])

# 26. bio11
vif(GIS_myco[,c(3:5, 7, 14, 20, 22:24, 26, 35, 39, 42, 43)])

# 27. bio12 
vif(GIS_myco[,c(3:5, 18,20, 22:24, 26, 28, 36, 39, 43)])

# 28. bio13
vif(GIS_myco[,c(3:5, 7, 14, 20, 22:24, 26, 28, 37, 39, 43)])

# 29. bio14 
vif(GIS_myco[,c(3:5, 14, 20, 22:24, 26, 28, 38, 39, 42, 43)])

# 30. bio16
vif(GIS_myco[,c(3:5, 7,14,20, 22:24, 26, 28, 39, 40, 43)])

# 31. bio17
vif(GIS_myco[,c(3:5, 14, 20, 22:24, 26, 28, 37, 39, 41,43)])

# 32. With things
vif(GIS_myco[,c(3:5,10,22:24,26, 30, 32, 39, 43)])

```


## Model selection with BM
```{r model selection BM}
#load required package
library(phylolm)

#define formula components and run function (forward)
## 1
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "BM", direction = "forward", trace = 2)
  # mycorrhiza ~ 1 + ClayPercentage + aridityIndexThornthwaite + minTempWarmest + PETWettestQuarter + PhCaCL + Slope + bio2 + bio4 + bio15 + bio18 + bio19

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "BM", direction = "forward", trace = 2)

#define formula components and run function (both)
## 1 
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "BM", direction = "both", trace = 2)
  # mycorrhiza ~ 1 + ClayPercentage + aridityIndexThornthwaite + minTempWarmest + PETWettestQuarter + PhCaCL + Slope + bio2 + bio4 + bio15 + bio18 + bio19
  # AIC(k=2): 2472.33792047599

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "BM", direction = "both", trace = 2)
  
```

The forward model with BM has the following model as the best model, with an AIC of...
  mycorrhiza ~
The both model with BM has the following model as the best model, with an AIC of ...
  mycorrhiza ~

## Model selection OUrandomRoot

```{r model selection OUrandomRoot}
#define formula components and run function (forward)
## 1
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUrandomRoot", direction = "forward", trace = 2)
  #  mycorrhiza ~ 1 + BulkDensity + minTempWarmest + PETWettestQuarter + PhCaCL + bio2 + bio4 + bio15 + bio19
  # AIC(k=2): 1497.98125594055

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUrandomRoot", direction = "forward", trace = 2)

#define formula components and run function (both)
## 1
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUrandomRoot", direction = "both", trace = 2)
  # mycorrhiza ~ 1 + BulkDensity + minTempWarmest + PETWettestQuarter + PhCaCL + bio2 + bio4 + bio15 + bio19
  # AIC(k=2): 1497.98125594055

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUrandomRoot", direction = "both", trace = 2)
  
```

The forward model with OUrandomRoot has the following model as the best model, with an AIC of...
  mycorrhiza ~
The both model with OUrandomRoot has the following model as the best model, with an AIC of ...
  mycorrhiza ~

## Model selection with OUfixedRoot

```{r model selection OUfixedRoot}
#define formula components and run function (forward)
## 1
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUfixedRoot", direction = "forward", trace = 2)
  # mycorrhiza ~ 1 + BulkDensity + minTempWarmest + PETWettestQuarter + PhCaCL + bio2 + bio4 + bio15 + bio19
  # AIC(k=2): 1497.98125594055

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUfixedRoot", direction = "forward", trace = 2)

#define formula components and run function (both)
## 1
phylostep(formula = myco_formula_1, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUfixedRoot", direction = "both", trace = 2)
  # mycorrhiza ~ 1 + BulkDensity + minTempWarmest + PETWettestQuarter + PhCaCL + bio2 + bio4 + bio15 + bio19
  # AIC(k=2): 1497.98125594055

## other formulas
phylostep(formula = myco_formula_10, starting.formula = myco_starting_formula, data = GIS_myco, phy = tree_myco, model = "OUfixedRoot", direction = "both", trace = 2)
 
```

The forward model with OUfixedRoot has the following model as the best model, with an AIC of...
  mycorrhiza ~
The both model with OUfixedRoot has the following model as the best model, with an AIC of ...
  mycorrhiza ~

## Conclusion
The best model can be made with the following combination:
Formula: 
Model: 
Direction: 

